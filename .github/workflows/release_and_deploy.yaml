name: GH Release, Publishing to Docker and Deployment to Heroku

on: [push, pull_request]

# on:
#   push:
#     tags:
#       - 'v*.*.*'

jobs:

  release-and-deploy:
    needs: build-and-test

    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      # - name: Release
      #   uses: softprops/action-gh-release@v1
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # - name: Publish to Registry
      #   uses: elgohr/Publish-Docker-Github-Action@master
      #   with:
      #     name: niklastiede/github-trending-api
      #     username: ${{ secrets.DOCKER_USERNAME }}
      #     password: ${{ secrets.DOCKER_PASSWORD }}

      - name: Deploy on Heroku
      - uses: akhileshns/heroku-deploy@v3.12.12
        with:
          heroku_api_key: ${{secrets.HEROKU_API_KEY}}
          heroku_app_name: "gh-trending-api"
          heroku_email: "niklastiede2@gmail.com"
          usedocker: true

